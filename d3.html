<!DOCTYPE html>
<head>
<meta charset="UTF-8"/>
<title>D3 test</title>
<script src="http://d3js.org/d3.v2.js"></script>
<script src="activity.js"></script>
<link rel="stylesheet" href="d3.css">

</head>
<body>
<script>
var data;
var m=[80,80,80,80];
var w=700 - m[1] - m[3];
var h=500 - m[0] - m[2];

var x = d3.scale.linear().range([0, w]),
    y = d3.scale.linear().range([h,0]),
    xAxis = d3.svg.axis().scale(x),
    yAxis = d3.svg.axis().scale(y).orient("left");

// line generator
var line = d3.svg.line()
    .x(function(d) { return x(d.x); })
    .y(function(d) { return y(d.y); })

d3.json("http://localhost:4001/20121012-1806.json", function(json) { 
    records = json_to_records(json);
    laps = json_to_laps(json);

    x.domain([0, records[records.length - 1].x]);
    y.domain([0, 1.1*d3.max(records, function(d) { return d.y; })]);

  var svg = d3.select("body").append("svg:svg")
      .attr("width", w + m[1] + m[3])
      .attr("height", h + m[0] + m[2])
    .append("svg:g")
      .attr("transform", "translate(" + m[3] + "," + m[0] +")");


  // Add the laps
  svg.selectAll(".fish")
      .data(laps)
    .enter().append("svg:rect")
      .attr("x", function(d) { return x(d.x0) })
      .attr("width", function(d) { return x(d.x1 - d.x0) })
      .attr("y", function(d) { return 0 })
      .attr("height", function(d) { return h })
      .attr("class", function(d,i) { return i%2==0 ? "even" : "odd" })

  // Add the line path.
  svg.append("svg:path")
      .attr("class", "line")
      .attr("clip-path", "url(#clip)")
      .attr("d", line(records));

  // Add the x-axis.
  svg.append("svg:g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + h + ")")
      .call(xAxis);

  // Add the y-axis.
  svg.append("svg:g")
      .attr("class", "y axis")
      .call(yAxis);
});

</script>
</body>
</html>
